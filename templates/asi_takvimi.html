<!DOCTYPE html>
<html lang="tr">
<head>
    <title>AÅŸÄ± Takvimi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light p-4">
<div class="container">
    {% if current_user.role == 'calisan' %}
        <a href="/calisan/panel" class="btn btn-secondary mb-3">&larr; Ã‡alÄ±ÅŸan Paneline DÃ¶n</a>
    {% else %}
        <a href="/dashboard" class="btn btn-secondary mb-3">&larr; Ana Panele DÃ¶n</a>
    {% endif %}

    <div class="row">
        {% if current_user.role in ['vet', 'admin'] %}
        <div class="col-md-5">
            <div class="card border-info">
                <div class="card-header bg-info text-white">AÅŸÄ± Planlama (Vet/Admin)</div>
                <div class="card-body">
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tekil">Tek Hayvan</button></li>
                        <li class="nav-item"><button class="nav-link text-danger" data-bs-toggle="tab" data-bs-target="#toplu">ðŸ“¢ Toplu (Grup)</button></li>
                    </ul>
                    <div class="tab-content pt-3">
                        <div class="tab-pane fade show active" id="tekil">
                            <form method="POST">
                                <select name="hayvan_id" class="form-select mb-2">
                                    {% for h in hayvanlar %}<option value="{{ h.id }}">{{ h.kupe_no }} ({{ h.padok_no }})</option>{% endfor %}
                                </select>
                                <input type="text" name="asi_adi" class="form-control mb-2" placeholder="AÅŸÄ± AdÄ±" required>
                                <input type="text" name="notlar" class="form-control mb-2" placeholder="Not (Opsiyonel)">
                                <input type="date" name="planlanan_tarih" class="form-control mb-2" required>
                                <button class="btn btn-primary w-100">Tek Ekle</button>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="toplu">
                            <form method="POST">
                                <label class="text-danger">Hangi Gruba?</label>
                                <select name="grup_id" class="form-select mb-2" required>
                                    {% for g in gruplar %}<option value="{{ g.id }}">{{ g.ad }} ({{ g.hayvanlar|length }} Hayvan)</option>{% endfor %}
                                </select>
                                <input type="text" name="asi_adi" class="form-control mb-2" placeholder="AÅŸÄ± AdÄ±" required>
                                <input type="text" name="notlar" class="form-control mb-2" placeholder="Not (Opsiyonel)">
                                <input type="date" name="planlanan_tarih" class="form-control mb-2" required>
                                <button class="btn btn-danger w-100">Gruba Planla</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        <div class="col-md-{% if current_user.role in ['vet', 'admin'] %}7{% else %}12{% endif %}">
            <div class="card shadow-sm">
                <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                    <span>AÅŸÄ± Takvimi / Bekleyenler</span>
                    <span class="badge bg-light text-dark">BugÃ¼n: {{ bugun }}</span>
                </div>
                <table class="table mb-0 table-hover align-middle">
                    <thead>
                        <tr>
                            <th>Tarih</th>
                            <th>Hayvan</th>
                            <th>AÅŸÄ± / Not</th>
                            <th>Ä°ÅŸlem</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for asi in asilar %}
                        <tr class="{% if asi.planlanan_tarih < bugun %}table-danger{% elif asi.planlanan_tarih == bugun %}table-warning{% else %}table-success{% endif %}">
                            <td>
                                {{ asi.planlanan_tarih }}
                                {% if asi.planlanan_tarih < bugun %}<br><span class="badge bg-danger">GecikmiÅŸ</span>{% endif %}
                            </td>
                            <td>
                                <strong>{{ asi.hayvan.kupe_no }}</strong>
                                <br><small class="text-muted">Padok: {{ asi.hayvan.padok_no }}</small>
                            </td>
                            <td>
                                <span class="fw-bold">{{ asi.asi_adi }}</span>
                                {% if asi.notlar %}<br><small class="text-secondary">Not: {{ asi.notlar }}</small>{% endif %}
                            </td>
                            <td>
                                <a href="/asi_yapildi/{{ asi.id }}" class="btn btn-primary btn-sm" onclick="return confirm('Bu aÅŸÄ±yÄ± uyguladÄ±nÄ±z mÄ±?')">
                                    ðŸ’‰ YapÄ±ldÄ±
                                </a>
                            </td>
                        </tr>
                        {% else %}
                        <tr><td colspan="4" class="text-center text-muted p-3">PlanlanmÄ±ÅŸ aÅŸÄ± bulunmuyor.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>