<!DOCTYPE html>
<html lang="tr">
<head><title>Panel</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<nav class="navbar navbar-dark bg-dark px-4">
    <a class="navbar-brand" href="#">SÃ¼rÃ¼ YÃ¶netim ({{ user.role.upper() }})</a>
    <div class="d-flex gap-2">
        <a href="/asi_takvimi" class="btn btn-sm btn-warning">ğŸ“… AÅŸÄ± Takvimi</a>
        {% if user.role in ['admin', 'sahip'] %}<a href="/islem_gecmisi" class="btn btn-sm btn-primary">ğŸ“Š Raporlar</a>{% endif %}
        {% if user.role == 'admin' %}<a href="/admin/users" class="btn btn-sm btn-info">ğŸ‘¥ KullanÄ±cÄ±lar</a>{% endif %}
        <a href="/hastalik_bildir" class="btn btn-sm btn-danger">ğŸš¨ Bildir</a>
        <a href="/logout" class="btn btn-sm btn-light">Ã‡Ä±kÄ±ÅŸ</a>
    </div>
</nav>

<div class="container mt-4">
    {% if bildirimler %}
    <div class="alert alert-danger">
        <h5>ğŸš¨ Acil Bildirimler</h5>
        <ul class="mb-0">{% for b in bildirimler %}<li>{{ b.hayvan.kupe_no }} - {{ b.aciklama }}</li>{% endfor %}</ul>
    </div>
    {% endif %}

    {% if user.role in ['admin', 'sahip', 'vet'] %}
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card p-3 h-100 border-primary">
                <h5>ğŸ“‹ GÃ¶rev Ata</h5>
                <form action="/gorev_ata" method="POST">
                    <select name="calisan_id" class="form-select mb-2">{% for c in calisanlar %}<option value="{{ c.id }}">{{ c.username }}</option>{% endfor %}</select>
                    <input type="text" name="aciklama" class="form-control mb-2" placeholder="GÃ¶rev?" required>
                    <button class="btn btn-primary w-100">Ata</button>
                </form>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 h-100 border-secondary">
                <h5>ğŸ·ï¸ Padok Ekle</h5>
                <form action="/grup_ekle" method="POST">
                    <input type="text" name="grup_ad" class="form-control mb-2" placeholder="Ad" required>
                    <input type="text" name="aciklama" class="form-control mb-2" placeholder="Not">
                    <button class="btn btn-secondary w-100">+</button>
                </form>
                <small class="text-muted d-block mt-2" style="max-height:80px;overflow-y:auto">{% for g in gruplar %}{{ g.ad }}, {% endfor %}</small>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card p-3 h-100 shadow-sm">
                <h6 class="text-success">ğŸ„ Yeni Hayvan KaydÄ±</h6>
                <form method="POST" class="row g-2">
                    <div class="col-4"><input type="text" name="kupe_no" class="form-control" placeholder="KÃ¼pe No" required></div>
                    <div class="col-4"><input type="text" name="padok_no" class="form-control" placeholder="Padok No" required></div>
                    <div class="col-4"><select name="grup_id" class="form-select"><option value="">Grup...</option>{% for g in gruplar %}<option value="{{ g.id }}">{{ g.ad }}</option>{% endfor %}</select></div>
                    <div class="col-3"><select name="tur" class="form-select"><option>Koyun</option><option>SÄ±ÄŸÄ±r</option></select></div>
                    <div class="col-3"><input type="text" name="irk" class="form-control" placeholder="Irk"></div>
                    <div class="col-3"><input type="number" name="yas_ay" class="form-control" placeholder="YaÅŸ (Ay)" required></div>
                    <div class="col-3"><select name="cinsiyet" class="form-select" id="cinsiyetSecimi" onchange="dogumGoster()"><option value="DiÅŸi">DiÅŸi</option><option value="Erkek">Erkek</option></select></div>
                    <div class="col-6" id="dogumInputDiv"><input type="number" name="dogum_sayisi" class="form-control" placeholder="DoÄŸum SayÄ±sÄ±" value="0"></div>
                    <div class="col-3 pt-2"><input type="checkbox" name="sagilabilir"> SaÄŸmal</div>
                    <div class="col-3"><button class="btn btn-success w-100">KAYDET</button></div>
                </form>
            </div>
        </div>
    </div>
    {% endif %}

    <table class="table table-white shadow-sm align-middle">
        <thead class="table-dark"><tr><th>KÃ¼pe / Padok</th><th>Grup</th><th>TÃ¼r / Irk</th><th>YaÅŸ</th><th>Cinsiyet / Gebelik</th><th>Durum</th><th>Ä°ÅŸlem</th></tr></thead>
        <tbody>
            {% for h in suru %}
            <tr>
                <td><strong>{{ h.kupe_no }}</strong><br><small class="text-muted">No: {{ h.padok_no }}</small></td>
                <td>{% if h.grup %}<span class="badge bg-secondary">{{ h.grup.ad }}</span>{% else %}-{% endif %}</td>
                <td>{{ h.tur }} / {{ h.irk }}</td>
                <td>{{ h.yas_ay }} Ay</td>
                <td>
                    {{ h.cinsiyet }}
                    {% if h.gebe_mi %}
                        <br><span class="badge bg-warning text-dark">ğŸ¤° GEBE</span>
                        {% if h.tohumlama_tarihi %}<small class="d-block text-muted" style="font-size:0.7em">{{ h.tohumlama_tarihi }}</small>{% endif %}
                    {% endif %}
                </td>
                <td><span class="badge {% if 'Hasta' in h.saglik_durumu %}bg-danger{% else %}bg-success{% endif %}">{{ h.saglik_durumu }}</span></td>
                <td>{% if user.role in ['admin', 'vet', 'sahip'] %}<a href="/vet/detay/{{ h.id }}" class="btn btn-warning btn-sm">Dosya</a>{% endif %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<script>
function dogumGoster() {
    var cinsiyet = document.getElementById("cinsiyetSecimi").value;
    var div = document.getElementById("dogumInputDiv");
    if (cinsiyet === "Erkek") div.style.display = "none"; else div.style.display = "block";
}
</script>
</body></html>